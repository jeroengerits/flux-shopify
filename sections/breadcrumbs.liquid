{% comment %}
  Dynamic Breadcrumb Section
  Automatically generates breadcrumbs based on the current page context
  Supports: pages, products, collections, blogs, articles, and search results
{% endcomment %}

{%- liquid
  assign breadcrumb_items = ''
  assign current_title = ''
  assign current_url = ''
  assign breadcrumb_links = ''

  case template
    when 'page'
      assign current_title = page.title
      assign current_url = page.url
      assign breadcrumb_items = 'page'
    when 'product'
      assign current_title = product.title
      assign current_url = product.url
      assign breadcrumb_items = 'product'

    when 'collection'
      assign current_title = collection.title
      assign current_url = collection.url
      assign breadcrumb_items = 'collection'
    when 'blog'
      assign current_title = blog.title
      assign current_url = blog.url
      assign breadcrumb_items = 'blog'
    when 'article'
      assign current_title = article.title
      assign current_url = article.url
      assign breadcrumb_items = 'article'
      assign breadcrumb_links = article.blog
    when 'search'
      assign current_title = 'Search Results'
      assign current_url = routes.search_url
      assign breadcrumb_items = 'search'
    when '404'
      assign current_title = 'Page Not Found'
      assign current_url = ''
      assign breadcrumb_items = '404'
    else
      assign current_title = page_title
      assign current_url = request.path
      assign breadcrumb_items = 'default'
  endcase
-%}

<div class='px-6'>
  <nav class='text-brand-neutral-400 flex items-center gap-1 text-sm font-light' aria-label='Breadcrumb'>
    {% if section.settings.show_home %}
      {% render 'link', text: 'Home', url: routes.root_url %}
    {% endif %}

    {% if breadcrumb_links != blank %}
      {% if section.settings.show_home %}
        {% render 'chevron' %}
      {% endif %}
      {% render 'link', text: breadcrumb_links.title, url: breadcrumb_links.url %}
    {% endif %}

    {% if breadcrumb_items == 'product' and breadcrumb_links == blank %}
      {% if section.settings.show_home %}
        {% render 'chevron' %}
      {% endif %}
      {% render 'link', text: 'Shop', url: '/collections/all' %}
    {% endif %}

    {% if current_title != 'Home' %}
      {% if section.settings.show_home or breadcrumb_links != blank or breadcrumb_items == 'product' %}
        {% render 'chevron' %}
      {% endif %}
      <span class='text-brand-neutral-700 font-normal' aria-current='page'>
        {% if current_title == 'Products' %}
          Shop
        {% else %}
          {{ current_title }}
        {% endif %}
      </span>
    {% endif %}
  </nav>
</div>

{% schema %}
{
  "name": "Breadcrumbs",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_home",
      "label": "Show Home link",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Breadcrumbs",
      "category": "Layout"
    }
  ]
}
{% endschema %}
